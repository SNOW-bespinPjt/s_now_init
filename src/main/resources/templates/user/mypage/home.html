<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Title</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
            src="https://code.jquery.com/jquery-3.7.1.js"
            integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
            crossorigin="anonymous"
    ></script>
    <script th:inline="javascript">

        $(document).ready(function () {
            let dtoSize = Math.ceil([[${userAttendanceDtos.size()}]] / 214);
            let width = document.querySelector(".attendenceRatio");
            console.log(width.style);
            console.log("width: " + dtoSize + "%");
        })

        function ajax_selectTardy() {
            console.log(" ajax_selectTardy() ")
            $.ajax({
                url: '/user/attendence/tardy',
                method: 'POST',
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log('AJAX SUCCESS - ajax_writeStudy()');
                    console.log("data : ", data)
                    let appendTag = ""
                    for (let i = 0; i < data.length; i++) {
                        let strStatus = ""
                        let statusColor = ""
                        let updateStatus = ""


                        if (data[i].astatus === 0) {
                            strStatus += "출석"
                            statusColor += "text-green-400"

                        }
                        if (data[i].astatus === 1) {
                            strStatus += "지각"
                            statusColor += "text-orange-400"
                            updateStatus = "<button class=\"mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                                "  제출\n" +
                                "</button>"

                        }

                        if (data[i].astatus === 2) {
                            strStatus += "병결"

                        }
                        if (data[i].astatus === 3) {
                            strStatus += "무단결석"
                            statusColor += "text-red-400"
                            updateStatus = "<button class=\" mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                                "  제출\n" +
                                "</button>"

                        }


                        appendTag += "     <div class=\" w-1/4 border-2 rounded-md shadow-xl mb-5 mr-4 h-48 \" >\n" +
                            "<div class='h-full relative'>" + `<p class=${statusColor}>` + strStatus + "</p>" + "<div class='absolute bottom-0 right-0'>" + updateStatus + "</div>" + "</div>" +
                            "                </div> "

                        let attendenceBody = "<div class=\"flex flex-col w-full h-full m-4\">\n" +
                            "            <div class=\"w-full border-b-2 h-full border-b-slate-200\">\n" +
                            "                <div class=\"mb-4 text-lg font-bold border-b-2 border-gray-200 pb-4\">출결사항</div>" +
                            "<div >"
                            + "<span class=\"inline-flex items-center bg-green-100 cursor-pointer text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300\" onclick='ajax_selectACK()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-green-500 rounded-full\"></span>\n" +
                            "                출석\n" +
                            "            </span> <span class=\"inline-flex items-center cursor-pointer bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300\" onclick='ajax_selectAbsent()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-red-500 rounded-full\"></span>\n" +
                            "                결석\n" +
                            "            </span>" +
                            " <span class=\"inline-flex items-center bg-red-100 text-red-800 cursor-pointer text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-orange-900 dark:text-orange-300\">\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-orange-500 rounded-full\"></span>\n" +
                            "                지각\n" +
                            "            </span>"
                            + "</div>" + "<div class='mt-6 flex flex-wrap items-center justify-center'>" + appendTag + "</div>" +
                            "</div>"
                        "</div>"


                        $(".section2").children().remove()
                        $(".section2").append(attendenceBody)
                    }
                }
                ,
                error: function (data) {
                    console.log('AJAX ERROR - ajax_writeStudy()');

                    // alert('일정 등록에 문제가 발생 했습니다.');

                }
                ,
                complete: function (data) {
                    console.log('AJAX COMPLETE - ajax_writeStudy()');


                }
            });
        }

        function ajax_selectACK() {
            console.log(" ajax_selectACK() ")
            $.ajax({
                url: '/user/attendence/ackattendence',
                method: 'POST',
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log('AJAX SUCCESS - ajax_writeStudy()');
                    console.log("data : ", data)
                    let appendTag = ""
                    for (let i = 0; i < data.length; i++) {
                        let strStatus = ""
                        let statusColor = ""
                        let updateStatus = ""


                        if (data[i].astatus === 0) {
                            strStatus += "출석"
                            statusColor += "text-green-400"

                        }
                        if (data[i].astatus === 1) {
                            strStatus += "지각"
                            statusColor += "text-orange-400"
                            updateStatus = "<button class=\"mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                                "  제출\n" +
                                "</button>"

                        }

                        if (data[i].astatus === 2) {
                            strStatus += "병결"

                        }
                        if (data[i].astatus === 3) {
                            strStatus += "무단결석"
                            statusColor += "text-red-400"
                            updateStatus = "<button class=\" mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                                "  제출\n" +
                                "</button>"

                        }


                        appendTag += "     <div class=\" w-1/4 border-2 rounded-md shadow-xl mb-5 mr-4 h-48 \" >\n" +
                            "<div class='h-full relative'>" + `<p class=${statusColor}>` + strStatus + "</p>" + "<div class='absolute bottom-0 right-0'>" + updateStatus + "</div>" + "</div>" +
                            "                </div> "

                        let attendenceBody = "<div class=\"flex flex-col w-full h-full m-4\">\n" +
                            "            <div class=\"w-full border-b-2 h-full border-b-slate-200\">\n" +
                            "                <div class=\"mb-4 text-lg font-bold border-b-2 border-gray-200 pb-4\">출결사항</div>" +
                            "<div >"
                            + "<span class=\"inline-flex items-center bg-green-100 cursor-pointer text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300\">\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-green-500 rounded-full\"></span>\n" +
                            "                출석\n" +
                            "            </span> <span class=\"inline-flex items-center cursor-pointer bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300\" onclick='ajax_selectAbsent()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-red-500 rounded-full\"></span>\n" +
                            "                결석\n" +
                            "            </span>" +
                            " <span class=\"inline-flex items-center bg-red-100 text-red-800 cursor-pointer text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-orange-900 dark:text-orange-300\"  onclick='ajax_selectTardy()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-orange-500 rounded-full\"></span>\n" +
                            "                지각\n" +
                            "            </span>"
                            + "</div>" + "<div class='mt-6 flex flex-wrap items-center justify-center'>" + appendTag + "</div>" +
                            "</div>"
                        "</div>"


                        $(".section2").children().remove()
                        $(".section2").append(attendenceBody)
                    }
                }
                ,
                error: function (data) {
                    console.log('AJAX ERROR - ajax_writeStudy()');

                    // alert('일정 등록에 문제가 발생 했습니다.');

                }
                ,
                complete: function (data) {
                    console.log('AJAX COMPLETE - ajax_writeStudy()');


                }
            });

        }

        function ajax_selectAbsent() {
            console.log(" ajax_selectAbsent(u_id) ")


            $.ajax({
                url: '/user/attendence/absent',
                method: 'POST',
                processData: false,
                contentType: false,
                success: function (data) {
                    console.log('AJAX SUCCESS - ajax_writeStudy()');
                    console.log("data : ", data)
                    let appendTag = ""
                    for (let i = 0; i < data.length; i++) {
                        let strStatus = ""
                        let statusColor = ""
                        let updateStatus = ""


                        if (data[i].astatus === 0) {
                            strStatus += "출석"
                            statusColor += "text-green-400"

                        }
                        if (data[i].astatus === 1) {
                            strStatus += "지각"
                            statusColor += "text-orange-400"
                            updateStatus = "<button class=\"mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                                "  제출\n" +
                                "</button>"

                        }

                        if (data[i].astatus === 2) {
                            strStatus += "병결"

                        }
                        if (data[i].astatus === 3) {
                            strStatus += "무단결석"
                            statusColor += "text-red-400"
                            updateStatus = "<button class=\" mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                                "  제출\n" +
                                "</button>"

                        }


                        appendTag += "     <div class=\" w-1/4 border-2 rounded-md shadow-xl mb-5 mr-4 h-48 \" >\n" +
                            "<div class='h-full relative'>" + `<p class=${statusColor}>` + strStatus + "</p>" + "<div class='absolute bottom-0 right-0'>" + updateStatus + "</div>" + "</div>" +
                            "                </div> "

                        let attendenceBody = "<div class=\"flex flex-col w-full h-full m-4\">\n" +
                            "            <div class=\"w-full border-b-2 h-full border-b-slate-200\">\n" +
                            "                <div class=\"mb-4 text-lg font-bold border-b-2 border-gray-200 pb-4\">출결사항</div>" +
                            "<div >"
                            + "<span class=\"inline-flex items-center bg-green-100 cursor-pointer text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300\" onclick='ajax_selectACK()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-green-500 rounded-full\"></span>\n" +
                            "                출석\n" +
                            "            </span> <span class=\"inline-flex items-center cursor-pointer bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300\" onclick='ajax_selectAbsent()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-red-500 rounded-full\"></span>\n" +
                            "                결석\n" +
                            "            </span>" +
                            " <span class=\"inline-flex items-center bg-red-100 text-red-800 cursor-pointer text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-orange-900 dark:text-orange-300\" onclick='ajax_selectTardy()'>\n" +
                            "                <span class=\"w-2 h-2 mr-1 bg-orange-500 rounded-full\"></span>\n" +
                            "                지각\n" +
                            "            </span>"
                            + "</div>" + "<div class='mt-6 flex flex-wrap items-center justify-center'>" + appendTag + "</div>" +
                            "</div>"
                        "</div>"


                        $(".section2").children().remove()
                        $(".section2").append(attendenceBody)
                    }
                }
                ,
                error: function (data) {
                    console.log('AJAX ERROR - ajax_writeStudy()');

                    // alert('일정 등록에 문제가 발생 했습니다.');

                }
                ,
                complete: function (data) {
                    console.log('AJAX COMPLETE - ajax_writeStudy()');


                }
            });


        }

        function attendenceTab(size) {
            console.log("attendenceTab")
            let appendTag = "";


            let arr = [[${userAttendanceDtos}]]
            console.log(typeof arr[0].astatus)

            for (let i = 0; i < size; i++) {
                let strStatus = ""
                let statusColor = ""
                let updateStatus = ""


                if (arr[i].astatus === 0) {
                    strStatus += "출석"
                    statusColor += "text-green-400"

                }
                if (arr[i].astatus === 1) {
                    strStatus += "지각"
                    statusColor += "text-orange-400"
                    updateStatus = "<button class=\"mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                        "  제출\n" +
                        "</button>"

                }

                if (arr[i].astatus === 2) {
                    strStatus += "병결"

                }
                if (arr[i].astatus === 3) {
                    strStatus += "무단결석"
                    statusColor += "text-red-400"
                    updateStatus = "<button class=\" mr-2 mb-2 bg-transparent hover:bg-blue-500 text-blue-700 font-semibold hover:text-white py-2 px-4 border border-blue-500 hover:border-transparent rounded\">\n" +
                        "  제출\n" +
                        "</button>"

                }


                appendTag += "     <div class=\" w-1/4 border-2 rounded-md shadow-xl mb-5 mr-4 h-48 \" >\n" +
                    "<div class='h-full relative'>" + `<p class=${statusColor}>` + strStatus + "</p>" + "<div class='absolute bottom-0 right-0'>" + updateStatus + "</div>" + "</div>" +
                    "                </div> "


            }

            let attendenceBody = "<div class=\"flex flex-col w-full h-full m-4\">\n" +
                "            <div class=\"w-full border-b-2 h-full border-b-slate-200\">\n" +
                "                <div class=\"mb-4 text-lg font-bold border-b-2 border-gray-200 pb-4\">출결사항</div>" +
                "<div >"
                + "<span class=\"inline-flex items-center bg-green-100 cursor-pointer text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300\" onclick='ajax_selectACK()' >\n" +
                "                <span class=\"w-2 h-2 mr-1 bg-green-500 rounded-full\"></span>\n" +
                "                출석\n" +
                "            </span> <span class=\"inline-flex items-center cursor-pointer bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300\" onclick='ajax_selectAbsent()'>\n" +
                "                <span class=\"w-2 h-2 mr-1 bg-red-500 rounded-full\"></span>\n" +
                "                결석\n" +
                "            </span>" +
                " <span class=\"inline-flex items-center bg-red-100 text-red-800 cursor-pointer text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-orange-900 dark:text-orange-300\" onclick='ajax_selectTardy()'>\n" +
                "                <span class=\"w-2 h-2 mr-1 bg-orange-500 rounded-full\"></span>\n" +
                "                지각\n" +
                "            </span>"
                + "</div>" + "<div class='mt-6 flex flex-wrap items-center justify-center'>" + appendTag + "</div>" + "</div>" +
                "</div>" +
                "</div>"

            $(".category p").removeClass("font-semibold").addClass("text-slate-400")
            $(".attendence").addClass("font-semibold").removeClass("text-slate-400")
            $(".section2").children().remove()
            $(".section2").append(attendenceBody)

        }


        function homeTab(ratio) {
            console.log("homeTab")
            console.log(ratio)
            const test = "<div class=\"flex flex-col w-full h-full m-4\">\n" +
                "            <div class=\"w-full border-b-2 h-1/3 border-b-slate-200\">\n" +
                "                <div class=\"mb-4 text-lg font-bold border-b-2 border-gray-200\">출결사항</div>\n" +
                "                <div class=\"relative flex flex-col items-center justify-center\">\n" +
                "                    <p class=\"mb-4 text-2xl text-green-500\">출석일 / 총 출석일</p>\n" +
                "\n" +
                "                    <div class=\"text-4xl font-bold font-extrabold mb-9\">[[${userAttendanceDtos.size()}]] 일/214일</div>\n" +
                "                    <div class=\"w-full bg-gray-200 rounded-full dark:bg-gray-700\">\n" +
                "                        <div\n" +
                "                                class=\"bg-blue-600 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full attendenceRatio\"\n" +
                "                                style=\"width: " + ratio + "%;\"\n" +
                "                        >\n" +
                "                            [[${ratio}]]%\n" +
                "                        </div>\n" +
                "                    </div>\n" +
                "                </div>\n" +
                "            </div>\n" +
                "            <div class=\"w-full border-b-2 h-1/3 border-b-slate-200\">\n" +
                "                <div class=\"mt-3 text-lg font-bold\"  >포인트</div>\n" +
                "            </div>\n" +
                "            <div class=\"w-full border-b-2 h-1/3 border-b-slate-200\">\n" +
                "                <div class=\"mt-3 text-lg font-bold\">스케쥴</div>\n" +
                "            </div>"

            $(".category p").removeClass("font-semibold").addClass("text-slate-400")
            $(".home").addClass("font-semibold").removeClass("text-slate-400")
            $(".section2").children().remove()
            $(".section2").append(test)

        }

        function pointTab() {
            console.log("pointTab")

            $(".category p").removeClass("font-semibold").addClass("text-slate-400")
            $(".point").addClass("font-semibold").removeClass("text-slate-400")
            $(".section2").children().remove()

        }

        function scheduleTab() {
            console.log("scheduleTab")

            $(".category p").removeClass("font-semibold").addClass("text-slate-400")
            $(".schedule").addClass("font-semibold").removeClass("text-slate-400")
            $(".section2").children().remove()

        }


    </script>

</head>
<body class="flex flex-col items-center justify-center w-5/6 mx-auto">
<header th:replace="~{/include/header_nav_footer::header}"></header>
<section class="flex flex-row w-5/6 border-solid mt-7">
    <div class="relative h-screen p-4 mr-3 border-4 divide-y-reverse rounded-lg w-96">
        <div class="w-full font-bold border-b-2 border-b-slate-200 h-60">
                            <span
                                    th:text="${session.loginedUserDto.id}+'('+${session.loginedUserDto.name}+')'"
                                    class="text-xl font-semibold"
                            >Sample username</span
                            >
            <div class="rounded-full"></div>
        </div>

        <div
                class="flex flex-col items-center justify-center h-auto border-b-2 border-b-slate-200 category"
        >
            <p
                    class="mt-5 mb-1 text-lg font-semibold cursor-pointer h-1/3 home"
                    th:onclick="'homeTab('+${ratio} +')'"
            >
                홈
            </p>
            <a th:onclick="'attendenceTab('+${userAttendanceDtos.size()}+')'">
                <p
                        class="mb-1 text-base text-lg cursor-pointer h-1/3 text-slate-400 attendence"
                >
                    출결사항
                </p></a
            >
            <p
                    class="mb-1 text-base text-lg cursor-pointer h-1/3 text-slate-400 point"
                    onclick="pointTab()"
            >
                포인트
            </p>
            <p
                    class="mb-5 text-base text-lg cursor-pointer text-slate-400 h-1/3 schedule"
                    onclick="scheduleTab()"
            >
                스케쥴
            </p>
        </div>
    </div>
    <div class="flex flex-col items-center w-3/4 h-screen p-8 border-2 rounded-lg section2">
        <div class="flex flex-col w-full h-full m-4">
            <div class="w-full border-b-2 h-1/3 border-b-slate-200">
                <div class="mb-4 text-lg font-bold">출결사항</div>
                <div class="relative flex flex-col items-center justify-center">
                    <p class="mb-4 text-2xl text-green-500">출석일 / 총 출석일</p>

                    <div class="text-4xl font-bold font-extrabold mb-9">
                        [[${userAttendanceDtos.size()}]] 일/214일
                    </div>
                    <div class="w-full bg-gray-200 rounded-full dark:bg-gray-700">
                        <div
                                class="bg-blue-600 text-xs font-medium text-blue-100 text-center p-0.5 leading-none rounded-full attendenceRatio"
                                th:style="'width: ' + ${ratio} +'%'"
                        >
                            [[${ratio}]]%
                        </div>
                    </div>
                </div>
            </div>
            <div class="w-full border-b-2 h-1/3 border-b-slate-200">
                <div class="mt-3 text-lg font-bold">포인트</div>
            </div>
            <div class="w-full border-b-2 h-1/3 border-b-slate-200">
                <div class="mt-3 text-lg font-bold">스케쥴</div>
            </div>
        </div>
    </div>
</section>
<footer th:replace="~{/include/header_nav_footer.html::footer}"></footer>
</body>
</html>
